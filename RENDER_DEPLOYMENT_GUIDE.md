# TeamTalk - Render Deployment Guide

Complete step-by-step guide to deploy TeamTalk to Render.com

## Table of Contents
1. [Prerequisites](#prerequisites)
2. [Step-by-Step Deployment](#step-by-step-deployment)
3. [Environment Variables](#environment-variables)
4. [Database Setup](#database-setup)
5. [Troubleshooting](#troubleshooting)
6. [Post-Deployment](#post-deployment)

---

## Prerequisites

Before deploying to Render, you'll need:

‚úÖ **Render Account**
- Sign up at https://render.com (free tier available)
- Verify your email address
- Have a valid payment method on file (even for free tier)

‚úÖ **MongoDB Atlas Account**
- Sign up at https://www.mongodb.com/cloud/atlas
- Create a free M0 cluster
- Get your connection string

‚úÖ **GitHub Repository**
- Push your TeamTalk code to GitHub (public or private)
- Ensure all code is committed and pushed

---

## Step-by-Step Deployment

### Step 1: Create MongoDB Atlas Database (5 minutes)

1. Go to https://www.mongodb.com/cloud/atlas
2. Sign in or create an account
3. Click "Create a Deployment"
4. Select **M0 (free tier)**
5. Choose your preferred cloud provider and region
6. Click "Create Deployment"
7. Create database user:
   - Username: `teamtalk_user`
   - Password: Generate secure password (save this!)
   - Click "Create Database User"
8. Add IP Whitelist:
   - Click "Add My Current IP" OR
   - Click "Add Entry" and enter `0.0.0.0/0` (allows all IPs)
   - Click "Confirm"
9. Click "Go to Databases"
10. Click "Connect"
11. Choose "Drivers"
12. Select Node.js and copy the connection string
    - Format: `mongodb+srv://username:password@cluster.mongodb.net/teamtalk?retryWrites=true&w=majority`
    - Replace `<password>` with your database user password
    - **Save this connection string** - you'll need it in Render

### Step 2: Connect GitHub to Render

1. Go to https://dashboard.render.com
2. Click "New +" ‚Üí "Web Service"
3. Click "Connect account" next to GitHub
4. Authorize Render to access your GitHub repositories
5. Select your TeamTalk repository
6. Click "Connect"

### Step 3: Configure Render Service

**Basic Settings:**
- **Name:** `teamtalk` (or your preferred name)
- **Environment:** `Node`
- **Build Command:** `npm ci && npm run build`
- **Start Command:** `npm start`
- **Plan:** Standard ($7/month) or Free (limited)

**Note:** Free tier will fall asleep after 15 minutes of inactivity. Standard tier recommended for reliability.

### Step 4: Add Environment Variables

Click "Environment" and add these variables:

| Key | Value | Notes |
|-----|-------|-------|
| `NODE_ENV` | `production` | Fixed value |
| `PORT` | `5000` | Fixed value |
| `MONGO_URI` | (paste from Step 1) | **Critical** - MongoDB connection string |
| `JWT_SECRET` | (auto-generated) | Leave blank - Render generates it |
| `SESSION_SECRET` | (auto-generated) | Leave blank - Render generates it |

**Steps to add environment variables:**
1. Click "Advanced" ‚Üí "Environment Variables"
2. Click "Add Environment Variable"
3. Enter Key and Value for each variable
4. **For JWT_SECRET and SESSION_SECRET:** Leave Value blank and Render will auto-generate

### Step 5: Deploy

1. Scroll down and click "Create Web Service"
2. Render will automatically:
   - Build the application
   - Install dependencies
   - Compile TypeScript
   - Build the React frontend
   - Start the Node.js server

**Deployment time:** 5-10 minutes for first deployment

### Step 6: Verify Deployment

1. Once deployment completes, you'll see a green checkmark
2. Click on the service URL (format: `https://teamtalk-xxxxx.onrender.com`)
3. You should see the TeamTalk login page
4. Try logging in to verify everything works

---

## Environment Variables

### Required Variables

#### `MONGO_URI` (Critical)
- **What:** MongoDB Atlas connection string
- **Format:** `mongodb+srv://username:password@cluster.mongodb.net/teamtalk?retryWrites=true&w=majority`
- **Get it from:** MongoDB Atlas dashboard ‚Üí Connect ‚Üí Drivers
- **Must have:** Valid credentials, correct cluster URL, database name

#### `JWT_SECRET` (Auto-generated by Render)
- **What:** Secret key for JWT token signing
- **Should be:** Long, random string (20+ characters)
- **Action:** Leave blank in Render config - Render generates automatically

#### `SESSION_SECRET` (Auto-generated by Render)
- **What:** Secret key for session encryption
- **Should be:** Long, random string (20+ characters)
- **Action:** Leave blank in Render config - Render generates automatically

#### `NODE_ENV`
- **What:** Environment mode
- **Value:** `production` (always for Render)

#### `PORT`
- **What:** Server port
- **Value:** `5000` (fixed by Render)

### Optional Configuration

If you want to add custom secrets later:

1. Go to Render Dashboard
2. Click on your service (teamtalk)
3. Click "Environment"
4. Edit variables as needed
5. Changes automatically redeploy the app

---

## Database Setup

### Initial Database Connection

Your MongoDB Atlas database is empty on first deployment. Here's what happens:

1. **First Login:** User documents are created
2. **Create Workspace:** Workspace collection created
3. **Create Channel:** Channel collection created
4. **Send Messages:** Message collection created

### Database Collections (Auto-created)

- `users` - User accounts with passwords
- `workspaces` - Team workspaces
- `channels` - Communication channels
- `messages` - Chat messages
- `directmessages` - 1-on-1 and group chat metadata
- `sessions` - Express session store (if using)

### Monitoring Database Usage

1. Go to MongoDB Atlas dashboard
2. Click "Collections" to see your data
3. Monitor usage metrics in "Atlas" ‚Üí "Monitoring"

**Free tier limits:**
- 512 MB storage
- 100 connections max
- Upgradeable anytime

---

## Troubleshooting

### Deploy Fails: "Build Command Failed"

**Solution:**
1. Check build logs in Render dashboard
2. Ensure `npm ci` completes successfully
3. Verify TypeScript compiles: Run locally `npm run check`
4. Check for missing environment variables
5. Push fixes to GitHub and redeploy

### App Crashes After Deploy: "Cannot connect to MongoDB"

**Solution:**
1. Verify `MONGO_URI` is correct:
   - Format: `mongodb+srv://user:pass@cluster.mongodb.net/database`
   - No spaces in connection string
   - Special characters in password properly formatted
2. Check MongoDB Atlas IP whitelist:
   - Go to Network Access
   - Ensure Render's IP is allowed (or use 0.0.0.0/0)
3. Test connection locally with same URI

### "CORS Error" or "Cannot reach API"

**Solution:**
1. Verify CORS is configured for Render domain
2. Check that app.ts includes `.render.app` and `.onrender.com`
3. In Render dashboard, restart the service
4. Clear browser cache and try again

### Free Tier Falls Asleep

**Issue:** App goes offline after 15 minutes of no requests

**Solution:**
1. Upgrade to Standard plan ($7/month)
2. Or use free tier for development only
3. Render will email when approaching limits

### Database Size Exceeds 512MB

**Solution:**
1. Upgrade to paid tier on MongoDB Atlas
2. Delete old data to free up space
3. Consider archiving old messages

---

## Post-Deployment

### 1. Test All Features

- [ ] User registration works
- [ ] User login works
- [ ] Create workspace
- [ ] Create channel
- [ ] Send messages in channel
- [ ] Create 1-on-1 chat
- [ ] Send and receive DMs in real-time
- [ ] Video/audio call buttons appear

### 2. Monitor Logs

View production logs in Render:

1. Go to Render Dashboard
2. Click "teamtalk" service
3. Click "Logs" tab
4. Monitor for errors and API usage

### 3. Set Up Auto-Deploy

In Render:
1. Service ‚Üí Settings ‚Üí Auto-Deploy
2. Select "Yes"
3. This automatically deploys when you push to GitHub

### 4. Custom Domain (Optional)

To use a custom domain:

1. Go to Service Settings
2. Click "Custom Domain"
3. Add your domain (e.g., teamtalk.yourdomain.com)
4. Follow DNS instructions
5. SSL certificate auto-generated

### 5. Scaling for Production

For production use:

- **Database:** Upgrade MongoDB to paid tier for better reliability
- **Server:** Consider Standard or Pro plan (higher resources)
- **Backups:** Enable MongoDB automatic backups
- **Monitoring:** Set up Render alerts for service health

---

## Common Deploy Commands

### Redeploy Manually
1. Go to Render Dashboard
2. Service Settings ‚Üí "Manual Deploy" ‚Üí "Deploy"

### View Logs
- Click "Logs" tab in service dashboard
- Scroll to see recent activity

### Check Health
- Visit: `https://yourdomain/api/health`
- Should return 200 status

### Restart Service
1. Service Settings
2. "Restart Service"
3. App stops and restarts (takes ~1 minute)

---

## Getting Help

### Render Support
- Documentation: https://render.com/docs
- Status: https://status.render.com
- Support: https://render.com/contact

### MongoDB Support
- Documentation: https://docs.mongodb.com
- Atlas Docs: https://docs.atlas.mongodb.com
- Support: https://support.mongodb.com

### TeamTalk Issues
- Check logs in Render dashboard
- Verify environment variables are set
- Ensure MongoDB connection string is correct

---

## Security Best Practices

‚úÖ **Do:**
- Keep JWT_SECRET and SESSION_SECRET private
- Use strong MongoDB password (20+ characters)
- Enable IP whitelist in MongoDB Atlas
- Use HTTPS (auto-enabled on Render)
- Regularly check logs for suspicious activity
- Keep dependencies updated

‚ùå **Don't:**
- Commit secrets to GitHub
- Use simple passwords
- Share connection strings
- Allow 0.0.0.0/0 in production (use Render's IP)
- Disable CORS security

---

## Success Checklist

‚úÖ MongoDB Atlas cluster created and accessible
‚úÖ Connection string obtained
‚úÖ GitHub repository connected to Render
‚úÖ Environment variables configured
‚úÖ Build command configured correctly
‚úÖ Start command configured correctly
‚úÖ Service deployed successfully
‚úÖ Login page loads without errors
‚úÖ Can create user account
‚úÖ Can create workspace and channels
‚úÖ Messages send and receive in real-time
‚úÖ Real-time DM sync works
‚úÖ Auto-deploy enabled on GitHub push

---

## Next Steps

1. **Share with Team:** Send the deployed URL to team members
2. **User Documentation:** Create user guide for your team
3. **Monitor Performance:** Check logs and metrics regularly
4. **Plan Upgrades:** Budget for MongoDB and Render upgrades as needed
5. **Backup Strategy:** Plan for data backups and recovery

---

**Deployment Complete!** üéâ

Your TeamTalk collaboration platform is now live on Render!
